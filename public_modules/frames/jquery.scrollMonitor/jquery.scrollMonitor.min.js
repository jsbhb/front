"use strict";!function(t){function o(s,i){var e=this;this.$body=t(document.body),this.$scrollElement=t(s).is(document.body)?t(window):t(s),this.options=t.extend({},o.DEFAULTS,i),this.selector=".ScrollMonitor>li>a[monitor]",this.offsets=[],this.targets=[],this.targetMap={},this.scrollHeight=0,this.timer=null,this.$scrollElement.on("scroll.bs.scrollMonitor",t.proxy(this.process,this)),t(s).find(this.selector).on("click.bs.scrollMonitor",function(){e.getTargetMap();var o=e.$scrollElement.scrollTop(),s=e.targetMap[t(this).attr("monitor")]-e.options.position_offset,i=0,l=0,r=0;t(this).hasClass("toTop")?(l=(i=0)-o,r=Math.ceil(l/30)):(l=(i=Math.round(s>0?s:0))-o,r=Math.ceil(l/30)),l&&(clearTimeout(e.timer),e.toScrollTop(l,i,r))}),this.init()}t.fn.scrollMonitor=function(t){return this.each(function(){var s="object"==typeof t&&t||{};this._scrollMonitor instanceof o?this._scrollMonitor.init():this._scrollMonitor=new o(this,s)})},o.DEFAULTS={active_offset:10,position_offset:10},o.prototype.init=function(){this.refresh(),this.process()},o.prototype.clear=function(){t(this.selector).parentsUntil(this.options.target,".active").removeClass("active")},o.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},o.prototype.refresh=function(){var o=this,s="offset",i=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),t.isWindow(this.$scrollElement[0])||(s="position",i=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var o=t(this).attr("monitor"),e=/^#./.test(o)&&t(o);return e&&e.length&&e.is(":visible")&&[[e[s]().top+i,o]]||null}).sort(function(t,o){return t[0]-o[0]}).each(function(){o.offsets.push(this[0]),o.targets.push(this[1])})},o.prototype.process=function(){var t,o=this.$scrollElement.scrollTop()+this.options.active_offset,s=this.getScrollHeight(),i=this.options.active_offset+s-this.$scrollElement.height(),e=this.offsets,l=this.targets,r=this.activeTarget;if(this.scrollHeight!=s&&this.refresh(),o>=i)return r!=(t=l[l.length-1])&&this.activate(t);if(r&&o<e[0])return this.activeTarget=null,this.clear();for(t=e.length;t--;)r!=l[t]&&o>=e[t]-3&&(void 0===e[t+1]||o<e[t+1])&&this.activate(l[t])},o.prototype.activate=function(o){this.activeTarget=o,this.clear();var s=this.selector+'[monitor="'+o+'"]',i=t(s).parents("li").addClass("active");i.parent(".dropdown-menu").length&&(i=i.closest("li.dropdown").addClass("active"))},o.prototype.getTargetMap=function(o){var s=this,i="offset",e=0;this.targetMap=[],t.isWindow(this.$scrollElement[0])||(i="position",e=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var o=t(this).attr("monitor"),l=/^#./.test(o)&&t(o);l&&l.length&&l.is(":visible")&&(s.targetMap[o]=l[i]().top+e)})},o.prototype.toScrollTop=function(t,o,s){var i=this,e=this.$scrollElement.scrollTop(),l=this.getScrollHeight(),r=this.options.active_offset+l-this.$scrollElement.height();if(t>0&&e<o&&Math.abs(e-o)>1){if(e+s<o&&e+s<r)this.$scrollElement.scrollTop(e+s);else{var n=r>o?o:r;this.$scrollElement.scrollTop(n)}this.timer=setTimeout(function(){i.toScrollTop(t,o,s)},10)}else if(t<0&&e>o&&Math.abs(e-o)>1){if(e+s>0&&e+s>o)this.$scrollElement.scrollTop(e+s);else{var h=o>0?o:0;this.$scrollElement.scrollTop(h)}this.timer=setTimeout(function(){i.toScrollTop(t,o,s)},10)}}}(window.jQuery);