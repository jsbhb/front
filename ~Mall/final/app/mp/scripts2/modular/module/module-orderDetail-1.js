define(["config.page.render"],function(e){"use strict";var o=window.capi.get();return e.extend({tags:{global:"<component-orderdetail-1></component-orderdetail-1>",payChoose:"<component-pay-choose-1></component-pay-choose-1>"},region:{global:{resDynamic:!0,beforeFunc:function(e,o){e.response.global.orderInfo=o.response.global.orderInfo.orderList[0]||{}}},payChoose:{cfgDynamic:!0}},config:{payChoose:{payChooseShow:!1,payState:null}},request:{},response:{},sendArr:["ORDER_USER_QUERY/global/orderInfo"],reload:!1,".component-orderDetail-content .orderItem .btn_viewLogistics touchend":function(e){var o=this,n=$(e),t=o.modules.message,r=n.attr("orderId"),a=o.renderData.global.response.orderInfo.attr();if(a){var i=!1,s=a.orderExpressList||[];$.each(s,function(e,o){if(o.expressId&&o.expressName)return i=!0,!1}),i?window.location.href="/logistics.html?orderId="+r:t.refresh({content:"暂无物流信息！"})}else t.refresh({content:"暂无物流信息！"})},".component-orderDetail-content .component-orderDetail-log .btn_toPay touchend":function(e){var n=this,t=$(e),r=n.modules.message,a=n.config.global.redirect,i=t.attr("orderId"),s=localStorage.getItem("openId");if(o.jsEvent.touch.focusTime<=300)return null;n.renderData.payChoose.config.attr("payChooseShow",!0),n.renderData.payChoose.config.attr("payState",$.Deferred()),$.when(n.renderData.payChoose.config.attr().payState).done(function(e){var o="",t="",c=function(){},d=function(){setTimeout(function(){window.location.replace(window.location.href)},200)};"weChatPay"===e&&(o="JSAPI",t=1,c=function(e){n.jsUtil.weChat.toPay("JSAPI",e.obj,{success:d})}),"aliPay"===e&&(o="scanCode",t=2,c=function(e){if(e.obj){var o="string"==typeof e.obj?e.obj:JSON.stringify(e.obj);window.localStorage.setItem("sendToAliPay",o),window.location.href="/pay-transfer.html"}}),"unionPay"===e&&(o="08",t=3,c=function(e){if(e.obj){var o="string"==typeof e.obj?e.obj:JSON.stringify(e.obj);window.localStorage.setItem("sendToYinLian",o),window.location.href="/pay-transfer.html"}}),n.sendRequest("PAY_ORDER",{orderId:i,payType:t,type:o,openId:s,redirect:a}).done(function(o){o&&o.success?c(o):o&&o.errorMsg?r.refresh({content:o.errorMsg,confirmBtn:!1}):"weChatPay"===e&&r.refresh({content:"该订单已被微信关闭，请手动关闭该订单！",confirmBtn:!1})}).fail(function(){r.refresh({type:"error",content:"支付失败！"})})})}})});