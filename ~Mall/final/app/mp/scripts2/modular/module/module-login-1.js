define(["config.page.render"],function(o){"use strict";var e=window.capi.get();return o.extend({tags:{global:"<component-login-1></component-login-1>"},region:{global:{cfgDynamic:!0,reqDynamic:!0,resDynamic:!1,beforeFunc:function(o,e){o.config.global.bShopArr=e.response.global||[]}}},config:{global:{isOpen:!1,isFocus:!1,iShopTimer:null,bombBox:!1,state:null}},request:{global:{account:"",password:""},USER_CHOOSESHOP_QUERY:{name:""}},response:{global:{}},sendArr:["USER_CHOOSESHOP_QUERY"],reload:!1,".component-login-shopInfo #shopInfo input":function(o){var e=this,n=$(o),t=n.val(),r=e.renderData.global.config.attr("iShopTimer");clearTimeout(r),t?(r=setTimeout(function(){e.sendRequest("USER_CHOOSESHOP_QUERY",{name:t}).done(function(o){o&&o.success&&e.renderData.global.config.attr("iShopArr",o.obj||[])}).fail(function(){e.renderData.global.config.attr("iShopArr",[])})},250),e.renderData.global.config.attr("iShopTimer",r)):(e.renderData.global.config.attr("iShopArr",[]),e.renderData.global.config.attr("iShopTimer",null)),e.renderData.global.config.attr("iShopId",""),e.renderData.global.config.attr("iDomain",""),e.renderData.global.config.attr("isFocus",!0)},".component-login-shopInfo #shopInfo blur":function(o){var e=this,n=$(o),t=n.val(),r=e.modules.message;t?e.sendRequest("USER_CHOOSESHOP_QUERY",{name:t}).done(function(o){o&&o.success?(e.renderData.global.config.attr("iShopArr",o.obj||[]),$.isEmptyObject(o.obj)&&r.refresh({type:"info",confirmBtn:!1,content:"暂未查询到与之相匹配的店铺！"})):o&&o.errorMsg?(e.renderData.global.config.attr("iShopArr",[]),r.refresh({type:"error",confirmBtn:!1,content:o.errorMsg})):(e.renderData.global.config.attr("iShopArr",[]),r.refresh({type:"info",confirmBtn:!1,content:"暂未查询到与之相匹配的店铺！"}))}).fail(function(o){o&&o.errorMsg?(e.renderData.global.config.attr("iShopArr",[]),r.refresh({type:"error",confirmBtn:!1,content:o.errorMsg})):(e.renderData.global.config.attr("iShopArr",[]),r.refresh({type:"error",confirmBtn:!1,content:"查询店铺失败！"}))}):e.renderData.global.config.attr("iShopArr",[]),e.renderData.global.config.attr("isFocus",!1)},".component-login-shopInfo #shopInfo touchend":function(o){var e=this,n=$(o),t=n.val();t&&e.sendRequest("USER_CHOOSESHOP_QUERY",{name:t}).done(function(o){o&&o.success&&e.renderData.global.config.attr("iShopArr",o.obj||[])}),n.focus(),e.renderData.global.config.attr("isFocus",!0)},".component-login-shopInfo ul.choose li touchend":function(o){var n=this,t=$(o),r=t.attr("domain")||"",a=t.attr("shopId")||"",i=t.attr("shopName")||"",c=t.parents(".component-login-shopInfo");return e.jsEvent.touch.touchIsMoved||(c.find("#shopInfo").blur(),n.renderData.global.config.attr("isFocus",!1),n.renderData.global.config.attr("iShopId",a),n.renderData.global.config.attr("iDomain",r),n.renderData.global.config.attr("iShopName",i)),!1},".component-login-shopInfo .btn_change touchend":function(){var o=this,e=o.renderData.global.config.attr("isOpen");o.renderData.global.config.attr("isOpen",!e),o.renderData.global.config.attr("iShopName",""),o.renderData.global.config.attr("iShopArr",[]),o.renderData.global.config.attr("iShopId",""),o.renderData.global.config.attr("iDomain","")},".component-login-account #account blur":function(o){var e=this,n=$(o),t=e.modules.message,r=e.renderData.global.request.attr();e.jsUtil.check.phone(r.account)&&e.jsUtil.weChat.browser()&&e.sendRequest("AUTH_CHECK",{userName:r.account,phone:r.account}).done(function(o){o&&!0===o.success&&0==o.obj?(t.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"该手机号尚未注册！"}),n.addClass("state_error")):n.removeClass("state_error")}).fail(function(){t.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"未能查询到该手机号是否已注册！"}),n.removeClass("state_error")})},".component-login-loginBtn:not(.state_error) touchend":function(){var o=this,n=o.element,t=o.modules.message,r=o.renderData.global.config.jumpUrl,a=o.renderData.global.request.attr(),i=n.find("#shopInfo").attr("domain")||"",c=n.find("#shopInfo").attr("shopId")||"";window.localStorage.removeItem("authId"),window.localStorage.removeItem("userId"),window.localStorage.removeItem("openId"),o.jsUtil.weChat.browser()?o.sendRequest("AUTH_LOGIN",{phone:a.account,password:a.password}).done(function(n){if(n&&n.success){var a=e.jsData.location.hostUrl,l=a+"/wechat-transfer.html",s='"Bearer "'+n.obj.token,f=n.obj.userCenterId,g=!1+"，，"+r+"，"+c+"，"+f+"，"+s+"，"+i;o.sendRequest("THIRD_WECHAT",{snsapiBase:!1,redirectUrl:l+"?info="+g}).done(function(o){"string"==typeof o&&(window.location.href=o)}),o.jsUtil.url.setParam({domain:i||""},"cover")}else n.errorMsg?t.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:n.errorMsg}):t.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"用户登录失败！"})}).fail(function(){t.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"用户登录失败！"})}):t.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"请在微信端进行操作！"})},".component-login-third .img_weChat touchend":function(){var o=this,n=(o.element,o.modules.message),t=o.config.global.jumpUrl,r=e.jsData.location.hostUrl,a=r+"/wechat-transfer.html",i=!0+"，，"+t;window.localStorage.removeItem("authId"),window.localStorage.removeItem("userId"),window.localStorage.removeItem("openId"),o.jsUtil.weChat.browser()?(o.renderData.global.config.attr("shopId"),o.sendRequest("THIRD_WECHAT",{snsapiBase:!0,redirectUrl:a+"?info="+i}).done(function(o){"string"==typeof o&&(window.location.href=o)})):n.refresh({cancelBtn:!1,confirmBtn:!1,content:"请在微信端进行操作！"})},".component-login-bombBox .body li:not(.lose) touchend":function(o){var n=this,t=$(o),r=t.attr("domain"),a=t.attr("shopId"),i=t.attr("shopName");return e.jsEvent.touch.touchIsMoved||(n.renderData.global.config.attr("bShopName",i?"店铺："+i:""),n.renderData.global.config.attr("bShopId",a||""),n.renderData.global.config.attr("bDomain",r||"")),!1},".component-login-bombBox .header .btn touchend":function(o){var e=this,n=$(o),t=e.element,r=e.modules.message,a=t.find("#bShopInfo"),i=a.attr("shopId")||"",c=a.attr("domain")||"";return n.hasClass("btn_ignore")?(t.find("input").removeAttr("disabled"),e.renderData.global.config.attr("bombBox",!1),e.renderData.global.config.attr("state").resolve("","")):n.hasClass("btn_sure")&&(i?(t.find("input").removeAttr("disabled"),e.renderData.global.config.attr("bombBox",!1),e.renderData.global.config.attr("state").resolve(c||"",i||"")):r.refresh({type:"info",confirmBtn:!1,content:"尚未选择店铺！"})),!1}})});