define(["config.page.render"],function(o){"use strict";var e=window.capi.get();return o.extend({tags:{global:"<component-login-1></component-login-1>"},region:{global:{cfgDynamic:!0,reqDynamic:!0,resDynamic:!1,beforeFunc:function(o,e){o.config.global.bShopArr=e.response.global||[]}}},config:{global:{isOpen:!1,isFocus:!1,iShopTimer:null,bombBox:!1,state:null}},request:{global:{account:"",password:""},USER_CHOOSESHOP_QUERY:{name:""}},response:{global:{}},sendArr:["USER_CHOOSESHOP_QUERY"],reload:!1,".component-login-shopInfo #shopInfo input":function(o){var e=this,t=$(o),n=t.val(),r=e.renderData.global.config.attr("iShopTimer");clearTimeout(r),n?(r=setTimeout(function(){e.sendRequest("USER_CHOOSESHOP_QUERY",{name:n}).done(function(o){o&&o.success&&e.renderData.global.config.attr("iShopArr",o.obj||[])}).fail(function(){e.renderData.global.config.attr("iShopArr",[])})},250),e.renderData.global.config.attr("iShopTimer",r)):(e.renderData.global.config.attr("iShopArr",[]),e.renderData.global.config.attr("iShopTimer",null)),e.renderData.global.config.attr("iShopId",""),e.renderData.global.config.attr("iDomain",""),e.renderData.global.config.attr("isFocus",!0)},".component-login-shopInfo #shopInfo blur":function(o){var e=this,t=$(o),n=t.val(),r=e.modules.message;n?e.sendRequest("USER_CHOOSESHOP_QUERY",{name:n}).done(function(o){o&&o.success?(e.renderData.global.config.attr("iShopArr",o.obj||[]),$.isEmptyObject(o.obj)&&r.refresh({type:"info",confirmBtn:!1,content:"暂未查询到与之相匹配的店铺！"})):o&&o.errorMsg?(e.renderData.global.config.attr("iShopArr",[]),r.refresh({type:"error",confirmBtn:!1,content:o.errorMsg})):(e.renderData.global.config.attr("iShopArr",[]),r.refresh({type:"info",confirmBtn:!1,content:"暂未查询到与之相匹配的店铺！"}))}).fail(function(o){o&&o.errorMsg?(e.renderData.global.config.attr("iShopArr",[]),r.refresh({type:"error",confirmBtn:!1,content:o.errorMsg})):(e.renderData.global.config.attr("iShopArr",[]),r.refresh({type:"error",confirmBtn:!1,content:"查询店铺失败！"}))}):e.renderData.global.config.attr("iShopArr",[]),e.renderData.global.config.attr("isFocus",!1)},".component-login-shopInfo #shopInfo touchend":function(o){var e=this,t=$(o),n=t.val();n&&e.sendRequest("USER_CHOOSESHOP_QUERY",{name:n}).done(function(o){o&&o.success&&e.renderData.global.config.attr("iShopArr",o.obj||[])}),t.focus(),e.renderData.global.config.attr("isFocus",!0)},".component-login-shopInfo ul.choose li touchend":function(o){var t=this,n=$(o),r=n.attr("domain")||"",a=n.attr("shopId")||"",i=n.attr("shopName")||"",l=n.parents(".component-login-shopInfo");return e.jsEvent.touch.touchIsMoved||(l.find("#shopInfo").blur(),t.renderData.global.config.attr("isFocus",!1),t.renderData.global.config.attr("iShopId",a),t.renderData.global.config.attr("iDomain",r),t.renderData.global.config.attr("iShopName",i)),!1},".component-login-shopInfo .btn_change touchend":function(){var o=this,e=o.renderData.global.config.attr("isOpen");o.renderData.global.config.attr("isOpen",!e),o.renderData.global.config.attr("iShopName",""),o.renderData.global.config.attr("iShopArr",[]),o.renderData.global.config.attr("iShopId",""),o.renderData.global.config.attr("iDomain","")},".component-login-account #account blur":function(o){var e=this,t=$(o),n=e.modules.message,r=e.renderData.global.request.attr();e.jsUtil.check.phone(r.account)&&e.jsUtil.weChat.browser()&&e.sendRequest("AUTH_CHECK",{userName:r.account,phone:r.account}).done(function(o){o&&!0===o.success&&0==o.obj?(n.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"该手机号尚未注册！"}),t.addClass("state_error")):t.removeClass("state_error")}).fail(function(){n.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"未能查询到该手机号是否已注册！"}),t.removeClass("state_error")})},".component-login-loginBtn:not(.state_error) touchend":function(){var o=this,t=o.element,n=o.modules.message,r=o.renderData.global.config.jumpUrl,a=o.renderData.global.request.attr(),i=t.find("#shopInfo").attr("domain")||"",l=t.find("#shopInfo").attr("shopId")||"";window.localStorage.removeItem("authId"),window.localStorage.removeItem("userId"),window.localStorage.removeItem("openId"),o.sendRequest("AUTH_LOGIN",{phone:a.account,password:a.password}).done(function(t){if(t&&t.success){var a=e.jsData.location.hostUrl,s=a+"/wechat-transfer.html",c='"Bearer "'+t.obj.token,g=t.obj.userCenterId,f=!1+"，，"+r+"，"+l+"，"+g+"，"+c+"，"+i;o.jsUtil.weChat.browser()?(o.sendRequest("THIRD_WECHAT",{snsapiBase:!1,redirectUrl:s+"?info="+f}).done(function(o){"string"==typeof o&&(window.location.href=o)}),o.jsUtil.url.setParam({domain:i||""},"cover")):(localStorage.setItem("authId",'"Bearer "'+t.obj.token),localStorage.setItem("userId",t.obj.userCenterId),o.jsUtil.url.jumpPage(r,null,!0))}else t.errorMsg?n.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:t.errorMsg}):n.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"用户登录失败！"})}).fail(function(){n.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"用户登录失败！"})})},".component-login-third .img_weChat touchend":function(){var o=this,t=(o.element,o.modules.message),n=o.config.global.jumpUrl,r=e.jsData.location.hostUrl,a=r+"/wechat-transfer.html",i=!0+"，，"+n;window.localStorage.removeItem("authId"),window.localStorage.removeItem("userId"),window.localStorage.removeItem("openId"),o.jsUtil.weChat.browser()?(o.renderData.global.config.attr("shopId"),o.sendRequest("THIRD_WECHAT",{snsapiBase:!0,redirectUrl:a+"?info="+i}).done(function(o){"string"==typeof o&&(window.location.href=o)})):t.refresh({cancelBtn:!1,confirmBtn:!1,content:"请在微信端进行操作！"})},".component-login-bombBox .body li:not(.lose) touchend":function(o){var t=this,n=$(o),r=n.attr("domain"),a=n.attr("shopId"),i=n.attr("shopName");return e.jsEvent.touch.touchIsMoved||(t.renderData.global.config.attr("bShopName",i?"店铺："+i:""),t.renderData.global.config.attr("bShopId",a||""),t.renderData.global.config.attr("bDomain",r||"")),!1},".component-login-bombBox .header .btn touchend":function(o){var e=this,t=$(o),n=e.element,r=e.modules.message,a=n.find("#bShopInfo"),i=a.attr("shopId")||"",l=a.attr("domain")||"";return t.hasClass("btn_ignore")?(n.find("input").removeAttr("disabled"),e.renderData.global.config.attr("bombBox",!1),e.renderData.global.config.attr("state").resolve("","")):t.hasClass("btn_sure")&&(i?(n.find("input").removeAttr("disabled"),e.renderData.global.config.attr("bombBox",!1),e.renderData.global.config.attr("state").resolve(l||"",i||"")):r.refresh({type:"info",confirmBtn:!1,content:"尚未选择店铺！"})),!1}})});