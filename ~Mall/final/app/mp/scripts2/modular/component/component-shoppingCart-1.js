define(["text!modular/template/template-shoppingCart-1.mustache"],function(t){"use strict";var e=window.capi.get();return can.Component.extend({tag:"component-shoppingcart-1",template:t,helpers:{returnSpec:function(t,r){var i=e.jsUtil.mustache.getContent(t,"string"),a=i&&JSON.parse(i);return i&&r.fn(a)},scopeConfig:function(t){this.spcConfig=e.jsUtil.mustache.getContent(t,"object")},spoceOrder:function(t,r){this.orders=e.jsUtil.mustache.getContent(t,"object"),this.config=e.jsUtil.mustache.getContent(r,"object"),this.setInit(),this.setNormalTotalPrice(),this.setCrossTotalPrice(),this.setOrderAllSelect(),this.setOrderOneSelect(),this.setOrderSelectedCount()},returnPrice:function(t,r){var i=e.jsUtil.mustache.getContent(t,"number"),a=e.jsUtil.mustache.getContent(r,"number");return(a<i?a:i).toFixed(2)},returnOrderNormalPrice:function(){return this.orders.attr("orderNormalTotalPrice").toFixed(2)},returnOrderCrossPrice:function(){return this.orders.attr("orderCrossTotalPrice").toFixed(2)},returnOrderPrice:function(t){var r=e.jsUtil.mustache.getDepContent(t,"object");return r&&r.orderTotalPrice&&r.orderTotalPrice.toFixed(2)||"0.00"},returnItemSelect:function(t,r,i,a){var n=e.jsUtil.mustache.getContent(t,"boolean"),s=e.jsUtil.mustache.getContent(r,"number"),c=e.jsUtil.mustache.getContent(i,"boolean");return n&&(0!==s||c)?a.fn(this):a.inverse(this)},returnStatus:function(t,r){return 0!==e.jsUtil.mustache.getContent(t,"number")?r.fn(this):r.inverse(this)},returnStock:function(t,r,i){var a=e.jsUtil.mustache.getContent(t,"number"),n=e.jsUtil.mustache.getContent(r,"number");return a>0&&a>=n?i.fn(this):i.inverse(this)},returnNormalShow:function(t){return this.orders.attr("orderNormalTotalPrice").toFixed(2)>0?t.fn(this):t.inverse(this)},returnCrossShow:function(t){return this.orders.attr("orderCrossTotalPrice").toFixed(2)>0?t.fn(this):t.inverse(this)},returnImgSrc:function(t){var r="";switch(e.jsUtil.mustache.getContent(t,"number")){case 0:r="/images/platform/tag/icon_cross.png";break;case 2:r="/images/platform/tag/icon_normal.png"}return r}},scope:{isFirst:!0,goodsTotalPrice:{},orderTotalPrice:0,setInit:function(){var t=this,e=t.orders.attr(),r=0;$.each(e.typeObj,function(e,i){$.each(i,function(i,a){$.each(a.itemObj,function(){r+=1}),$.isEmptyObject(a.itemObj)&&(t.orders.typeObj[e][i].removeAttr("itemObj"),t.orders.typeObj[e].removeAttr(i))}),$.isEmptyObject(i)&&t.orders.typeObj.removeAttr(e)}),t.orders.attr("quantity",r)},setNormalTotalPrice:function(){var t=this,e=0,r=t.orders.attr();$.each(r.typeObj,function(r,i){$.each(i,function(i,a){var n=0,s=0,c=0,o=0,u=0;$.each(a.itemObj,function(e,p){if(2==a.type){var l=t.getNumRegion(p.priceList),m=l.minQuantity,y=l.maxQuantity;p.quantity=p.quantity>y?y:p.quantity,p.quantity=p.quantity<m?m:p.quantity,p.quantity=p.quantity>p.stock?p.stock:p.quantity,p.quantity=p.quantity>0?p.quantity:1,t.orders.typeObj[r][i].itemObj[e].attr("quantity",p.quantity),t.orders.typeObj[r][i].itemObj[e].attr("minQuantity",l.minQuantity),t.orders.typeObj[r][i].itemObj[e].attr("maxQuantity",l.maxQuantity);var d=t.getPriceList(p.priceList,p.quantity);t.orders.typeObj[r][i].itemObj[e].attr("price",d.price),t.orders.typeObj[r][i].itemObj[e].attr("vipPrice",d.vipPrice),t.orders.typeObj[r][i].itemObj[e].attr("realPrice",d.realPrice),t.orders.typeObj[r][i].itemObj[e].attr("realVipPrice",d.realVipPrice),t.orders.typeObj[r][i].itemObj[e].attr("stock",p.stock>0?p.stock:0),t.isFirst&&(t.isFirst=!1,t.orders.typeObj[r][i].itemObj[e].attr("selected",0!==p.status&&p.stock>0&&p.stock>=m)),p.selected&&0!==p.status&&p.stock>0&&(n+=p.weight*p.quantity,s+=d.price*p.quantity,c+=d.vipPrice*p.quantity,o+=d.realPrice*p.quantity,u+=d.realVipPrice*p.quantity),m&&y&&m!==-1/0&&y!==1/0?t.orders.typeObj[r][i].itemObj[e].attr("quantityDes","当前允许购买量为: "+m+"~"+y):m&&m!==-1/0?t.orders.typeObj[r][i].itemObj[e].attr("quantityDes","当前最小购买量为: "+m):y&&y!==1/0?t.orders.typeObj[r][i].itemObj[e].attr("quantityDes","当前最大购买量为: "+y):t.orders.typeObj[r][i].itemObj[e].attr("quantityDes","")}}),2==r&&(t.orders.typeObj[r][i].attr("supplierWeight",1*n),t.orders.typeObj[r][i].attr("supplierPrice",1*s),t.orders.typeObj[r][i].attr("supplierVipPrice",1*c),t.orders.typeObj[r][i].attr("supplierRealPrice",1*o),t.orders.typeObj[r][i].attr("supplierRealVipPrice",1*u)),e+=o<s?o:s})}),t.orders.attr("orderNormalTotalPrice",e)},setCrossTotalPrice:function(){var t=this,e=0,r=t.orders.attr();$.each(r.typeObj,function(r,i){$.each(i,function(i,a){var n=0,s=0,c=0,o=0,u=0;$.each(a.itemObj,function(e,p){if(0==a.type){var l=t.getNumRegion(p.priceList),m=l.minQuantity,y=l.maxQuantity;p.quantity=p.quantity>y?y:p.quantity,p.quantity=p.quantity<m?m:p.quantity,p.quantity=p.quantity>p.stock?p.stock:p.quantity,p.quantity=p.quantity>0?p.quantity:1,t.orders.typeObj[r][i].itemObj[e].attr("quantity",p.quantity),t.orders.typeObj[r][i].itemObj[e].attr("minQuantity",l.minQuantity),t.orders.typeObj[r][i].itemObj[e].attr("maxQuantity",l.maxQuantity);var d=t.getPriceList(p.priceList,p.quantity);t.orders.typeObj[r][i].itemObj[e].attr("price",d.price),t.orders.typeObj[r][i].itemObj[e].attr("vipPrice",d.vipPrice),t.orders.typeObj[r][i].itemObj[e].attr("realPrice",d.realPrice),t.orders.typeObj[r][i].itemObj[e].attr("realVipPrice",d.realVipPrice),t.orders.typeObj[r][i].itemObj[e].attr("stock",p.stock>0?p.stock:0),t.isFirst&&(t.isFirst=!1,t.orders.typeObj[r][i].itemObj[e].attr("selected",0!==p.status&&p.stock>0&&p.stock>=m)),p.selected&&0!==p.status&&p.stock>0&&(n+=p.weight*p.quantity,s+=d.price*p.quantity,c+=d.vipPrice*p.quantity,o+=d.realPrice*p.quantity,u+=d.realVipPrice*p.quantity),m&&y&&m!==-1/0&&y!==1/0?t.orders.typeObj[r][i].itemObj[e].attr("quantityDes","当前允许购买量为: "+m+"~"+y):m&&m!==-1/0?t.orders.typeObj[r][i].itemObj[e].attr("quantityDes","当前最小购买量为: "+m):y&&y!==1/0?t.orders.typeObj[r][i].itemObj[e].attr("quantityDes","当前最大购买量为: "+y):t.orders.typeObj[r][i].itemObj[e].attr("quantityDes","")}}),0==r&&(t.orders.typeObj[r][i].attr("supplierWeight",1*n),t.orders.typeObj[r][i].attr("supplierPrice",1*s),t.orders.typeObj[r][i].attr("supplierVipPrice",1*c),t.orders.typeObj[r][i].attr("supplierRealPrice",1*o),t.orders.typeObj[r][i].attr("supplierRealVipPrice",1*u)),e+=o<s?o:s})}),t.orders.attr("orderCrossTotalPrice",e)},setOrderAllSelect:function(){var t=this,e=t.orders.attr(),r=this.config.attr("optionsOpen"),i=e.quantity,a=!0;$.each(e.typeObj,function(e,n){$.each(n,function(t,e){$.each(e.itemObj,function(t,e){if(!e.selected&&(0!==e.status&&e.stock>0&&e.stock>=e.minQuantity||r))return a=!1,!1;e.selected||!(0===e.status||e.stock<=0||e.stock<e.minQuantity)||r||(i-=1)})}),t.orders.attr("allSelected",a&&!!i)})},setOrderOneSelect:function(){var t=this,e=this.orders.attr(),r=e.quantity,i=!1;$.each(e.typeObj,function(e,a){$.each(a,function(r,a){$.each(a.itemObj,function(a,n){var s=t.orders.typeObj[e][r].itemObj[a].attr("quantity");if(n.selected&&s)return i=!0,!1})}),t.orders.attr("oneSelected",i&&!!r)})},setOrderSelectedCount:function(){var t=this.orders.attr(),e=0;$.each(t.typeObj,function(t,r){$.each(r,function(t,r){$.each(r.itemObj,function(t,r){r.selected&&(e+=1)})})}),this.orders.attr("selectedCount",e)},getNumRegion:function(t){var e={},r=[],i=[],a=!1;return $.each(t,function(t,e){var n=e.min?e.min:0,s=e.max?e.max:Number.POSITIVE_INFINITY;r.push(s),i.push(n),a=!0}),a?(e.minQuantity=Math.min.apply(Math,i),e.maxQuantity=Math.max.apply(Math,r),e):{minQuantity:0,maxQuantity:Number.POSITIVE_INFINITY}},getPriceList:function(t,e){var r={},i={},a=[],n=[],s=[],c=[],o=[],u=[],p=[],l=!1;return $.each(t,function(t,e){var r=e.min?e.min:0,i=e.max?e.max:Number.POSITIVE_INFINITY,m=e.price||0===e.price?(1*e.price).toFixed(2):null,y=e.vipPrice||0===e.vipPrice?(1*e.vipPrice).toFixed(2):null,d=m?e.discount?(e.price*e.discount/10).toFixed(2):(1*e.price).toFixed(2):null,h=y?e.discount?(e.vipPrice*e.discount/10).toFixed(2):(1*e.vipPrice).toFixed(2):null;a.push({prices:{price:m,vipPrice:y,realPrice:d,realVipPrice:h},min:r,max:i}),s.push(r),n.push(i),c.push(m),o.push(y),u.push(d),p.push(h),l=!0}),l?(i.min=Math.min.apply(Math,s),i.max=Math.max.apply(Math,n),i.minPrice=Math.min.apply(Math,c),i.vipMinPrice=Math.min.apply(Math,o),i.realMinPrice=Math.min.apply(Math,u),i.realVipMinPrice=Math.min.apply(Math,p),i.maxPrice=Math.max.apply(Math,c),i.vipMaxPrice=Math.max.apply(Math,o),i.realMaxPrice=Math.max.apply(Math,u),i.realVipMaxPrice=Math.max.apply(Math,p),e<i.min?{price:i.maxPrice,vipPrice:i.vipMaxPrice,realPrice:i.realMaxPrice,realVipPrice:i.realVipMaxPrice}:e>i.max?{price:i.minPrice,vipPrice:i.vipMinPrice,realPrice:i.realMinPrice,realVipPrice:i.realVipMinPrice}:($.each(a,function(t,i){if(e>=i.min&&e<=i.max)return r={price:i.prices.price,vipPrice:i.prices.vipPrice,realPrice:i.prices.realPrice,realVipPrice:i.prices.realVipPrice},!1}),r)):{price:null,vipPrice:null,realPrice:null,realVipPrice:null}}},events:{inserted:function(){this.element.find(".component-shoppingCart-ordersDetails    .goodsList ").find(".controlGroup").css("transform","translate3d(748px, 0, 0)")},removed:function(){}}})});