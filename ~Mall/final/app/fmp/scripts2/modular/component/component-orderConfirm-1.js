define(["text!modular/template/template-orderConfirm-1.mustache"],function(e){"use strict";var t=window.capi.get();return can.Component.extend({tag:"component-orderconfirm-1",template:e,helpers:{spoceOrder:function(e){this.orders=t.jsUtil.mustache.getContent(e),this.setTaxFee(),this.setOrderPrice()},returnSpec:function(e,r){var n=t.jsUtil.mustache.getContent(e,"string"),a=n&&JSON.parse(n);return n&&r.fn(a)},returnPrice:function(e){return t.jsUtil.mustache.getContent(e,"number").toFixed(2)},returnSupplierName:function(e){var r="",n=t.jsUtil.mustache.getDepContent(e,"string");switch(n){case"天天仓":r="保税TT仓";break;case"粮油仓":r="保税LY仓";break;case"行云仓":r="保税XY仓";break;case"富邦仓":r="保税FB仓";break;default:r=n}return r},returnImgSrc:function(e){var r="";switch(t.jsUtil.mustache.getContent(e,"number")){case 0:r="/images/platform/tag/icon_cross.png";break;case 2:r="/images/platform/tag/icon_normal.png"}return r},returnIsShow:function(e,r){return void 0!=t.jsUtil.mustache.getContent(e,"number")?r.fn(this):r.inverse(this)},returnPostFee:function(e,r){var n=t.jsUtil.mustache.getContent(e,"string"),a=t.jsUtil.mustache.getContent(r,"number");return"2"===n?'<span class="money">物流或快递</span><span class="symbol"></span>':'<span class="money">'+a.toFixed(2)+'</span><span class="symbol">￥</span>'},returnTaxFee:function(e,r){var n=t.jsUtil.mustache.getContent(e,"number");return 2==t.jsUtil.mustache.getContent(r,"number")?"总价已含税费":"￥"+n},returnShow:function(){return 124==localStorage.getItem("shopId")?"0.00 ":"0.00"}},scope:{setTaxFee:function(){var e=this,t=e.orders.attr();$.each(t.typeObj,function(t,r){$.each(r,function(r,n){var a=0,s=0,i=0,o=n.postFee,c=n.supplierPrice;$.each(n.itemObj,function(u,p){if(0==p.freeTax&&0==n.type){var m=(p.quantity||0)*(p.price||0),d=m/c*o,l=(m+d)/(1-p.exciseTax)*p.exciseTax,h=(m+d+l)*p.incrementTax,b=.7*(l+h);e.orders.typeObj[t][r].itemObj[u].attr("taxFee",b),e.orders.typeObj[t][r].itemObj[u].attr("postFee",d),a+=b,s+=l,i+=h}}),e.orders.typeObj[t][r].attr("taxFee",1*a.toFixed(2)),e.orders.typeObj[t][r].attr("exciseTaxFee",1*s.toFixed(2)),e.orders.typeObj[t][r].attr("incrementTaxFee",1*i.toFixed(2))})})},setOrderPrice:function(){var e=this,t=this.orders.attr(),r=localStorage.getItem("shopId");$.each(t.typeObj,function(t,n){$.each(n,function(n,a){var s=1*a.rakebackSupplierRealPrice,i=a.discountPrice||0,o=1*a.taxFee+1*a.rakebackSupplierRealPrice+1*a.postFee;e.orders.typeObj[t][n].attr("totalPrice",(1*s).toFixed(2)),e.orders.typeObj[t][n].attr("orderPrice",(1*o).toFixed(2)),124==r?e.orders.typeObj[t][n].attr("orderDiscountPrice",(1*o-1*i-0).toFixed(2)):e.orders.typeObj[t][n].attr("orderDiscountPrice",(1*o-1*i).toFixed(2))})})}},events:{inserted:function(){},removed:function(){}}})});