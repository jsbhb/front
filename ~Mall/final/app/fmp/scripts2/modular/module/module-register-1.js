define(["config.page.render"],function(e){"use strict";var n=window.capi.get();return e.extend({tags:{global:"<component-register-1></component-register-1>"},region:{global:{cfgDynamic:!0,reqDynamic:!0,resDynamic:!1}},config:{global:{}},request:{global:{account:"",validation:"",password:"",confirmPassword:"",invitationCode:""}},sendArr:[],reload:!1,".component-register-account #account blur":function(e){var n=this,t=$(e),r=n.modules.message,o=n.renderData.global.request.attr();n.jsUtil.check.phone(o.account)&&n.jsUtil.weChat.browser()&&n.sendRequest("AUTH_CHECK",{userName:o.account,phone:o.account}).done(function(e){e&&!0===e.success&&1==e.obj?(r.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"该手机号已被注册！"}),t.addClass("state_error")):t.removeClass("state_error")}).fail(function(){r.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"未能查询到该手机号是否已注册！"}),t.removeClass("state_error")})},".component-register-validation .getValidation touchend":function(e){var n=this,t=$(e),r=n.element,o=n.modules.message,a=t.parents(".component-register-validation");r.find("#account").blur(),n.jsUtil.weChat.browser()?setTimeout(function(){var e=n.renderData.global.request.attr();!r.find("#account").hasClass("state_error")&&n.jsUtil.check.phone(e.account)&&n.sendRequest("THIRD_PHONE",{phone:e.account}).done(function(e){if(e&&e.success){var n=60,r=function(e){n>0?(n--,a.find(".doing .val").text(n),setTimeout(function(){r(e)},1e3)):e.addClass("getValidation")};t.removeClass("getValidation"),r(t)}else o.refresh({type:"warring",cancelBtn:!1,confirmBtn:!1,content:"验证码发送过于频繁"})}).fail(function(){o.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"抱歉，手机验证码发送失败，请重试！"})})},200):o.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"请在微信端进行操作！"})},".component-register-registerBtn:not(.state_error) touchend":function(){var e=this,t=e.element,r=e.modules.message,o=n.jsData.userInfo.shopId||"",a=n.jsData.userInfo.gradeId||"",c=e.renderData.global.config.jumpUrl||"";window.localStorage.removeItem("authId"),window.localStorage.removeItem("userId"),window.localStorage.removeItem("openId"),window.localStorage.removeItem("welfareVip"),e.jsUtil.weChat.browser()?setTimeout(function(){var s=e.renderData.global.request.attr(),i=!t.find("#account").hasClass("state_error"),l=s.invitationCode&&(""+s.invitationCode).trim();i&&e.jsUtil.check.phone(s.account)&&e.sendRequest("USER_REGISTRATION",{centerId:o||a,phone:s.account,pwd:s.password,code:s.validation,invitationCode:l?(""+s.invitationCode).trim():void 0}).done(function(t){if(t&&t.success){var a=t.obj;e.sendRequest("AUTH_REGISTER",{phone:s.account,password:s.password,userCenterId:a}).done(function(t){if(t&&t.success){var a=n.jsData.location.hostUrl,s=a+"/wechat-transfer.html",i='"Bearer "'+t.obj.token,l=t.obj.userCenterId,d=!1+"，true，"+c+"，"+o+"，"+l+"，"+i+"，";e.sendRequest("THIRD_WECHAT",{snsapiBase:!1,redirectUrl:s+"?info="+d}).done(function(e){"string"==typeof e&&(window.location.href=e)})}else t.errorMsg?r.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:t.errorMsg}):r.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"用户注册失败！"})}).fail(function(){r.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"用户注册失败！"})})}else t&&1==t.obj?r.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"验证码失效，请重试！"}):t.errorMsg?r.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:t.errorMsg}):r.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"用户注册失败！"})}).fail(function(){r.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"用户注册失败！"})})},200):r.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"请在微信端进行操作！"})}})});