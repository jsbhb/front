define(["config.page.render"],function(e){"use strict";var n=window.capi.get(),o=n.jsData.userInfo.shopId,t=n.jsData.userInfo.userId,r=n.jsData.userInfo.gradeId;return e.extend({tags:{global:"<component-bindinvitation-1></component-bindinvitation-1>"},region:{global:{reqDynamic:!0,resDynamic:!1,beforeFunc:function(e,n){e.response.global.userInfo&&(e.config.global.account=e.response.global.userInfo.phone||"",e.request.global.account=e.response.global.userInfo.phone||"")}}},config:{global:{}},request:{global:{account:"",invitationCode:""},USER_INVITERCODE_BIND:{id:t,shopId:o||r}},response:{global:{}},sendArr:["USER_DETAIL_QUERY/global/userInfo"],reload:!1,".component-bindInvitation-bingBtn:not(.state_error) touchend":function(){var e=this,o=e.modules.message,t=e.renderData.global.request.attr(),r=e.renderData.global.config.jumpUrl;e.jsUtil.weChat.browser()?e.sendRequest("USER_INVITERCODE_BIND",{phone:t.account,invitationCode:t.invitationCode}).done(function(t){if(t&&t.success)if(t&&t.obj){var s=n.jsData.userInfo.shopId,c=n.jsData.userInfo.userId,a="v:"+s+"-"+c;r&&(window.localStorage.setItem("welfareVip",a),e.jsUtil.url.jumpPage(r,null)),r||(window.localStorage.setItem("welfareVip",a),e.jsUtil.url.jumpPage("/index.html",null))}else t&&t.errorMsg?o.refresh({type:"error",content:t.errorMsg,cancelBtn:!1,confirmBtn:!1}):o.refresh({type:"error",content:"绑定邀请码失败！",cancelBtn:!1,confirmBtn:!1});else t&&t.errorMsg?o.refresh({type:"error",content:t.errorMsg,cancelBtn:!1,confirmBtn:!1}):o.refresh({type:"error",content:"绑定邀请码失败！",cancelBtn:!1,confirmBtn:!1})}).fail(function(){o.refresh({type:"error",content:"绑定邀请码失败！",cancelBtn:!1,confirmBtn:!1})}):o.refresh({cancelBtn:!1,confirmBtn:!1,content:"请在微信端进行操作！"})},".component-bindInvitation-content .getCode span touchend":function(){var e=this,n=e.response.global.userInfo.phone,o=localStorage.getItem("shopId"),t=e.modules.message;124==o?e.sendRequest("USER_INVITERCODE_APPLY",{gradeId:o,phone:n}).done(function(e){e&&e.success?t.refresh({type:"success",content:"邀请码已发送！",cancelBtn:!1,confirmBtn:!1}):t.refresh({type:"error",content:"抱歉，邀请码发送失败，请重试！",cancelBtn:!1,confirmBtn:!1})}).fail(function(){t.refresh({type:"error",content:"网络故障，请确认网络是否正常！",cancelBtn:!1,confirmBtn:!1})}):t.refresh({type:"error",content:"",cancelBtn:!1,confirmBtn:!1})}})});