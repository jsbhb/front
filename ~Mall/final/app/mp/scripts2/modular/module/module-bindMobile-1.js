define(["config.page.render"],function(e){"use strict";var t=window.capi.get();return e.extend({tags:{global:"<component-bindmobile-1></component-bindmobile-1>"},region:{global:{reqDynamic:!0,resDynamic:!1}},config:{global:{}},request:{global:{account:"",validation:""}},response:{global:{}},sendArr:[],reload:!1,".component-bindMobile-validation .getValidation touchend":function(e){var t=this,n=$(e),o=t.modules.message,r=t.renderData.global.request.attr(),a=n.parents(".component-bindMobile-validation");t.jsUtil.weChat.browser()?t.jsUtil.check.phone(r.account)&&t.sendRequest("THIRD_PHONE",{phone:r.account}).done(function(e){if(e&&e.success){var t=60,r=function(e){t>0?(t--,a.find(".doing .val").text(t),setTimeout(function(){r(e)},1e3)):e.addClass("getValidation")};n.removeClass("getValidation"),r(n)}else o.refresh({type:"warring",cancelBtn:!1,confirmBtn:!1,content:"验证码发送过于频繁"})}).fail(function(){o.refresh({type:"error",cancelBtn:!1,confirmBtn:!1,content:"抱歉，手机验证码发送失败，请重试！"})}):o.refresh({cancelBtn:!1,confirmBtn:!1,content:"请在微信端进行操作！"})},".component-bindMobile-bingBtn:not(.state_error) touchend":function(){var e=this,n=e.element,o=e.modules.message,r=e.renderData.global.config.jumpUrl,a=t.jsData.userInfo.shopId,s=t.jsData.userInfo.openId;window.localStorage.removeItem("userId"),window.localStorage.removeItem("openId"),window.localStorage.removeItem("authId"),e.jsUtil.weChat.browser()?setTimeout(function(){var t=e.renderData.global.request.attr();!n.find("#account").hasClass("state_error")&&e.jsUtil.check.phone(t.account)&&e.sendRequest("USER_REGISTRATION",{phone:t.account,code:t.validation}).done(function(t){if(t&&t.success){var n=t.obj;e.sendRequest("AUTH_LOGIN",{userCenterId:n}).done(function(t){if(t&&t.success){var c='"Bearer "'+t.obj.token;window.localStorage.setItem("userId",n),window.localStorage.setItem("authId",c),window.localStorage.setItem("openId",s),window.localStorage.setItem("alertDiscount",!0),a&&window.localStorage.setItem("shopId",a),e.jsUtil.url.jumpPage(r,"/index.html")}else t.errorMsg?o.refresh({type:"error",content:t.errorMsg}):o.refresh({type:"error",content:"绑定手机失败！"})}).fail(function(){o.refresh({type:"error",content:"绑定手机失败！"})})}else t&&1==t.obj?o.refresh({type:"error",content:"验证码失效，请重试！"}):t.errorMsg?o.refresh({type:"error",content:t.errorMsg}):o.refresh({type:"error",content:"绑定手机失败！"})}).fail(function(){o.refresh({type:"error",content:"绑定手机失败！"})})},200):o.refresh({cancelBtn:!1,confirmBtn:!1,content:"请在微信端进行操作！"})}})});