define(["config.page.render"],function(o){"use strict";var n=window.capi.get(),e=n.jsData.userInfo.userId,a=n.jsData.userInfo.shopId,t=n.jsData.userInfo.gradeId,s=(n.jsData.userInfo.authId,n.jsData.userInfo.openId,n.jsData.userInfo.isLogin),l=["GRADE_GRADEBO_QUERY_REDIS/global/gradeInfo"];return a&&(l=l.concat(["USER_SHOPINFO_QUERY/global/shopInfo"])),s&&(l=l.concat(["USER_DETAIL_QUERY/global/userInfo","ORDER_USER_STATUS_COUNT/global/orderStatus","USER_INVITERINFO_CHECK/global/getInvitation"])),o.extend({tags:{global:"<component-personal-center-1></component-personal-center-1>"},region:{global:{cfgDynamic:!0,reqDynamic:!0,resDynamic:!0,beforeFunc:function(o,e){var a=0,t=0,s=0,l=0,r=o.config.global.shopName,i=o.config.global.shopAbout,c=o.config.global.shopHeadImg,f=o.config.global.shopDescribe;$.each(e.response.global.orderStatus,function(o,n){var e=n.status,r=n.total;0===e?a+=r:1===e||2===e||3===e||4===e||5===e||11===e||12===e?t+=r:6===e?s+=r:7===e&&(l+=r)}),o.config.global.shopInfo=e.response.global&&e.response.global.shopInfo||{},o.config.global.shopInfo.headImg=o.config.global.shopInfo.headImg||c,o.config.global.shopInfo.aboutus=o.config.global.shopInfo.aboutus||i,o.config.global.shopInfo.name=o.config.global.shopInfo.name||r,o.config.global.shopInfo.description=f,o.response.global.orderStatus={},o.response.global.orderStatus.needPay=a,o.response.global.orderStatus.needDeliver=t,o.response.global.orderStatus.needReceived=s,o.response.global.orderStatus.finish=l,o.response.global.gradeInfo&&1===o.response.global.gradeInfo.welfareType&&(!1===o.response.global.getInvitation&&(n.jsData.userInfo.welfareVip=!1,o.config.global.needInvitation=!0),!0===o.response.global.getInvitation&&(n.jsData.userInfo.welfareVip=!0,o.config.global.needInvitation=!1),o.config.global.showWelfare=!0)}}},config:{global:{shopName:n.jsData.siteInfo.shopName,shopAbout:n.jsData.siteInfo.shopAbout,shopHeadImg:n.jsData.siteInfo.shopHeadImg,shopDescribe:n.jsData.siteInfo.shopDescribe,needInvitation:!0,showWelfare:!1}},request:{global:{},USER_INVITERINFO_CHECK:{shopId:a||t,id:e}},response:{global:{}},sendArr:l,reload:!1,".component-personal-center-order a touchend":function(){var o=this,e=o.modules.message,a=o.config.global.pathUrl;return!n.jsEvent.touch.touchIsMoved&&(o.renderData.global.config.isLogin?void 0:(e.refresh({content:"您尚未登录，是否登录？",DOMClick:!1,cancelBtn:!0,confirmBtn:!0,cancelFun:function(){},confirmFun:function(){window.location.href="/login.html?jumpUrl="+a}}),!1))},".component-personal-center-function a.apply touchend":function(o){var e=this,a=$(o),t=e.modules.message,s=e.renderData.global.config,l=e.renderData.global.response,r=e.config.global.pathUrl,i=l.userInfo&&l.userInfo.phone,c=s.attr("shopId")||l.userInfo.shopId,f=s.attr("centerId"),g=s.attr("shopName"),u=a.hasClass("needSign");return!n.jsEvent.touch.touchIsMoved&&(u&&!e.renderData.global.config.isLogin?(t.refresh({content:"您尚未登录，是否登录？",DOMClick:!1,cancelBtn:!0,confirmBtn:!0,cancelFun:function(){},confirmFun:function(){location.href="/login.html?jumpUrl="+r}}),!1):void e.sendRequest("USER_PUSHUSER_CHECK",{phone:i,gradeId:c}).done(function(o){o&&o.success?window.location.href="/apply.html?phone="+i+"&shopName="+g+"&centerId="+f+"&shopId="+c:t.refresh({cancelBtn:!1,confirmBtn:!1,content:"已在该店铺申请成为推手！"})}))},".component-personal-center-function a:not(.apply) touchend":function(o){var e=this,a=$(o),t=e.modules.message,s=e.config.global.pathUrl,l=a.hasClass("needSign");return!n.jsEvent.touch.touchIsMoved&&(l&&!e.renderData.global.config.isLogin?(t.refresh({content:"您尚未登录，是否登录？",DOMClick:!1,cancelBtn:!0,confirmBtn:!0,cancelFun:function(){},confirmFun:function(){window.location.href="/login.html?jumpUrl="+s}}),!1):void 0)},".component-personal-center-function a.fmpMall touchend":function(o){var e=this,a=n.jsData.userInfo,t=e.renderData.global.config.attr(),s=n.jsData.userInfo.userId,l=n.jsData.userInfo.shopId,r=n.jsData.userInfo.authId,i=n.jsData.userInfo.openId,c=n.jsData.siteInfo.fDomainName,f="";if(n.jsEvent.touch.touchIsMoved)return!1;a.isLogin||(f="v:",window.location.href=n.jsUtil.path.setParam(c.replace(/\/$/,"")+"/login.html",{shopId:l,openId:i,welfareVip:f})),a.isLogin&&(!0===t.needInvitation&&(f="v:",window.location.href=n.jsUtil.path.setParam(c.replace(/\/$/,"")+"/bindInvitation.html",{userId:s,shopId:l,authId:r,openId:i,welfareVip:f})),!1===t.needInvitation&&(f="v:"+l+"-"+s,window.location.href=n.jsUtil.path.setParam(c,{userId:s,shopId:l,authId:r,openId:i,welfareVip:f})))},".component-personal-center-logout touchend":function(){var o=this,e=o.modules.footer,a=o.modules.message,t=n.jsData.userInfo;if(n.jsEvent.touch.touchIsMoved)return!1;a.refresh({content:"是否退出当前账号？",DOMClick:!1,cancelBtn:!0,confirmBtn:!0,cancelFun:function(){},confirmFun:function(){t.isLogin=!1,o.config.global.isLogin=!1,e.config.global.isLogin=!1,o.response.global.userInfo={},o.response.global.orderStatus={},window.localStorage.removeItem("userId"),window.localStorage.removeItem("authId"),o.renderData.global.config.attr("isLogin",!1),e.renderData.global.config.attr("isLogin",!1),document.querySelector("title").innerHTML=o.config.global.shopInfo.name||"中国供销海外购",o.toRender(["USER_SHOPINFO_QUERY/global/shopInfo"],[{shopId:null,userId:null}],["global"])}})},".component-personal-center-login touchend":function(){var o=this,e=o.config.global.pathUrl;if(n.jsEvent.touch.touchIsMoved)return!1;window.location.href="/login.html?jumpUrl="+e}})});